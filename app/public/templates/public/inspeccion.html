{% from "_render_elements.html" import render_messages %}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>INSPRE | Sistema de gestión</title>
<link rel="shortcut icon" href="{{ url_for('static', filename='imgs/favicon.ico') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap/bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

</head>
<body>
  <div class="content-no-nav">
    {{ render_messages(messages) }}
    <div class="container mt-4">
     
        <h2>Nodo: {{ nodos.nombre }}</h2>

        <!-- Botón para iniciar cámara -->
        <div id="inicioContainer" class="text-center" style="margin: 20px 0;">
          <button id="iniciarCamara" class="btn btn-primary btn-lg">📷 Abrir cámara</button>
        </div>

        <!-- Vista previa cámara (oculta al inicio) -->
        <div id="videoContainer" style="position: relative; max-width: 100%; display: none;">
          <video id="video" autoplay playsinline style="width:100%; max-width:600px; border:2px solid #333; border-radius:8px; display:block;"></video>

          <!-- Título del nodo sobre el video -->
          <div class="nodo-title">📋 Nodo: {{ nodos.nombre }}</div>

          <!-- Overlay con imagen SVG -->
          {% if overlay_svg_url %}
            <div id="overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
             <img src="{{ overlay_svg_url }}" alt="" style="width: 100%; height: 100%; object-fit: contain;">
            </div>
          {% endif %}

          <!-- Botones de control sobre el video -->
          <div id="controlesContainer" class="mt-3" style="display: none;">
            <button id="cambiarCamara" class="btn btn-secondary" disabled>🔄</button>
            <button id="capturar" class="btn btn-primary" disabled>📸 Capturar</button>
          </div>
        </div>

        <!-- Canvas oculto para procesar -->
        <canvas id="canvas" style="display:none;"></canvas>

        <!-- Preview después de capturar -->
        <div id="previewContainer" style="display:none; margin-top:20px;">
          <h5>Vista previa:</h5>
          <img id="preview" style="max-width:100%; max-height:400px; border:1px solid #ccc; border-radius:8px;">
          <div class="mt-2">
            <button id="rehacer" class="btn btn-warning">🔄 Tomar otra</button>
          </div>
        </div>

        <!-- Formulario para enviar -->
        <form id="form" method="POST" enctype="multipart/form-data" style="margin-top:20px; display:none;">
          {{ form.hidden_tag() if form }}
          <button type="submit" class="btn btn-success btn-lg">⬆️ Subir al servidor</button>
        </form>
  
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.bundle.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
</body>
</html>